<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://unpkg.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        connect-src 'self' https://api.mainnet-beta.solana.com https://api.devnet.solana.com https://api.duckduckgo.com https://en.wikipedia.org https://api.dexscreener.com;
        img-src 'self' data: https:;
        frame-ancestors 'none';
    ">
    <title>üîí NULLA DEBUG LAB</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --bg-panel: #12121a;
            --border: #1e1e2e;
            --accent: #00ff88;
            --accent-dim: #00ff8840;
            --text: #e0e0e0;
            --text-dim: #666;
            --red: #ff4757;
            --yellow: #ffa502;
            --blue: #00d4ff;
            --purple: #a855f7;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
        }
        
        /* ===== PASSCODE GATE ===== */
        #gate {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }
        
        #gate.hidden { display: none; }
        
        .gate-title {
            font-size: 24px;
            color: var(--accent);
            margin-bottom: 20px;
            text-shadow: 0 0 20px var(--accent-dim);
        }
        
        .gate-input {
            background: var(--bg-panel);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px 25px;
            font-size: 24px;
            color: var(--accent);
            text-align: center;
            letter-spacing: 8px;
            width: 250px;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .gate-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 20px var(--accent-dim);
        }
        
        .gate-input.error {
            border-color: var(--red);
            animation: shake 0.3s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .gate-hint {
            margin-top: 15px;
            color: var(--text-dim);
            font-size: 12px;
        }
        
        /* ===== MAIN LAYOUT ===== */
        #main {
            display: none;
            height: 100vh;
            grid-template-columns: 1fr 500px;
            grid-template-rows: auto 1fr;
        }
        
        #main.active {
            display: grid;
        }
        
        /* Header */
        #header {
            grid-column: 1 / -1;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-title span {
            color: var(--accent);
            font-weight: bold;
        }
        
        .header-badge {
            background: var(--red);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            text-transform: uppercase;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .header-btn {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
            transition: all 0.2s;
        }
        
        .header-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* Nulla Panel */
        #nulla-panel {
            background: var(--bg);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 50px);
        }
        
        /* Debug Panel */
        #debug-panel {
            background: var(--bg-panel);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 50px);
        }
        
        .panel-header {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            color: var(--text-dim);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .panel-header span {
            color: var(--accent);
        }
        
        /* Debug Log */
        #debug-log {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-size: 11px;
            line-height: 1.6;
        }
        
        .log-entry {
            padding: 8px 10px;
            margin-bottom: 6px;
            background: var(--bg);
            border-radius: 6px;
            border-left: 3px solid var(--border);
        }
        
        .log-entry.intent { border-left-color: var(--blue); }
        .log-entry.search { border-left-color: var(--purple); }
        .log-entry.response { border-left-color: var(--accent); }
        .log-entry.error { border-left-color: var(--red); }
        .log-entry.state { border-left-color: var(--yellow); }
        .log-entry.api { border-left-color: #ff9500; }
        
        .log-time {
            color: var(--text-dim);
            font-size: 9px;
            margin-bottom: 4px;
        }
        
        .log-type {
            display: inline-block;
            padding: 1px 6px;
            border-radius: 3px;
            font-size: 9px;
            text-transform: uppercase;
            margin-right: 8px;
        }
        
        .log-type.intent { background: var(--blue); color: #000; }
        .log-type.search { background: var(--purple); color: #fff; }
        .log-type.response { background: var(--accent); color: #000; }
        .log-type.error { background: var(--red); color: #fff; }
        .log-type.state { background: var(--yellow); color: #000; }
        .log-type.api { background: #ff9500; color: #000; }
        
        .log-content {
            color: var(--text);
            word-break: break-word;
        }
        
        .log-content pre {
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 4px;
            margin-top: 6px;
            overflow-x: auto;
            font-size: 10px;
            white-space: pre-wrap;
        }
        
        /* State Panel */
        #state-panel {
            border-top: 1px solid var(--border);
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            font-size: 10px;
        }
        
        .state-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .state-key { color: var(--text-dim); }
        .state-value { color: var(--accent); }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-dim); }
    </style>
</head>
<body>
    <!-- PASSCODE GATE -->
    <div id="gate">
        <div class="gate-title">üîí NULLA DEBUG LAB</div>
        <input 
            type="password" 
            id="passcode" 
            class="gate-input" 
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
            maxlength="6"
            autofocus
        >
        <div class="gate-hint">Enter access code</div>
    </div>
    
    <!-- MAIN DEBUG INTERFACE -->
    <div id="main">
        <header id="header">
            <div class="header-title">
                <span>üß™ NULLA DEBUG LAB</span>
                <span class="header-badge">DEV ONLY</span>
            </div>
            <div class="header-actions">
                <button class="header-btn" onclick="clearLog()">üóëÔ∏è Clear Log</button>
                <button class="header-btn" onclick="exportLog()">üì§ Export</button>
                <button class="header-btn" onclick="resetNulla()">üîÑ Reset Nulla</button>
                <button class="header-btn" onclick="location.reload()">‚ü≥ Reload</button>
            </div>
        </header>
        
        <div id="nulla-panel">
            <!-- Nulla container -->
            <div id="nulla-app" style="height: 100%; display: flex; justify-content: center; align-items: flex-start; padding: 20px;"></div>
        </div>
        
        <div id="debug-panel">
            <div class="panel-header">
                <span>üìä DEBUG LOG</span>
                <span id="log-count">0 entries</span>
            </div>
            <div id="debug-log"></div>
            <div id="state-panel">
                <div class="panel-header"><span>üß† NULLA STATE</span></div>
                <div id="state-display"></div>
            </div>
        </div>
    </div>
    
    <!-- NullaSoul SDK -->
    <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
    <script src="../assets/nulla/nulla-soul-sdk.js"></script>
    
    <!-- Nulla Core -->
    <script src="../assets/nulla/nulla-core.js"></script>
    
    <script>
        // ===== CONFIG =====
        const ACCESS_CODE = 'null42'; // Change this!
        
        // ===== PASSCODE GATE =====
        const gate = document.getElementById('gate');
        const main = document.getElementById('main');
        const passcodeInput = document.getElementById('passcode');
        
        passcodeInput.addEventListener('input', (e) => {
            const code = e.target.value;
            // Only check when we have enough characters
            if (code.length === ACCESS_CODE.length) {
                if (code === ACCESS_CODE) {
                    gate.classList.add('hidden');
                    main.classList.add('active');
                    initDebugLab();
                } else {
                    e.target.classList.add('error');
                    setTimeout(() => {
                        e.target.classList.remove('error');
                        e.target.value = '';
                    }, 300);
                }
            }
        });
        
        // Also allow Enter key
        passcodeInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const code = e.target.value;
                if (code === ACCESS_CODE) {
                    gate.classList.add('hidden');
                    main.classList.add('active');
                    initDebugLab();
                } else {
                    e.target.classList.add('error');
                    setTimeout(() => {
                        e.target.classList.remove('error');
                        e.target.value = '';
                    }, 300);
                }
            }
        });
        
        // ===== DEBUG LOGGER =====
        const debugLog = document.getElementById('debug-log');
        const logCount = document.getElementById('log-count');
        let logEntries = [];
        
        function log(type, message, data = null) {
            const entry = {
                time: new Date().toLocaleTimeString(),
                type,
                message,
                data
            };
            logEntries.push(entry);
            
            const div = document.createElement('div');
            div.className = `log-entry ${type}`;
            div.innerHTML = `
                <div class="log-time">${entry.time}</div>
                <span class="log-type ${type}">${type}</span>
                <span class="log-content">${message}</span>
                ${data ? `<pre>${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}</pre>` : ''}
            `;
            debugLog.appendChild(div);
            debugLog.scrollTop = debugLog.scrollHeight;
            
            logCount.textContent = `${logEntries.length} entries`;
        }
        
        function clearLog() {
            debugLog.innerHTML = '';
            logEntries = [];
            logCount.textContent = '0 entries';
            log('state', 'Log cleared');
        }
        
        function exportLog() {
            const blob = new Blob([JSON.stringify(logEntries, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nulla-debug-${Date.now()}.json`;
            a.click();
            log('state', 'Log exported');
        }
        
        function resetNulla() {
            if (window.Nulla) {
                Nulla.state = null;
                localStorage.removeItem('nulla_state_v2');
                log('state', 'Nulla state reset - reload page');
            }
        }
        
        // ===== STATE DISPLAY =====
        function updateStateDisplay() {
            if (!window.Nulla || !Nulla.state) return;
            
            const stateDisplay = document.getElementById('state-display');
            const s = Nulla.state;
            
            stateDisplay.innerHTML = `
                <div class="state-row">
                    <span class="state-key">Stage</span>
                    <span class="state-value">${s.evolution?.stage || 1} - ${s.evolution?.title || 'Glitch'}</span>
                </div>
                <div class="state-row">
                    <span class="state-key">XP</span>
                    <span class="state-value">${s.evolution?.xp || 0}</span>
                </div>
                <div class="state-row">
                    <span class="state-key">Knowledge Items</span>
                    <span class="state-value">${s.knowledgeBase?.length || 0}</span>
                </div>
                <div class="state-row">
                    <span class="state-key">Conversations</span>
                    <span class="state-value">${s.userProfile?.totalConversations || 0}</span>
                </div>
                <div class="state-row">
                    <span class="state-key">Soul Hash</span>
                    <span class="state-value">${s.soulHash?.slice(0, 16) || 'none'}...</span>
                </div>
                <div class="state-row">
                    <span class="state-key">Personality</span>
                    <span class="state-value">üòä${(s.personality?.friendliness || 0).toFixed(1)} üé≠${(s.personality?.sass || 0).toFixed(1)}</span>
                </div>
            `;
        }
        
        // ===== HOOK INTO NULLA =====
        function initDebugLab() {
            log('state', 'üß™ Debug Lab initialized');
            
            // Wait for Nulla to load
            const checkNulla = setInterval(() => {
                if (window.Nulla) {
                    clearInterval(checkNulla);
                    hookNulla();
                }
            }, 100);
        }
        
        function hookNulla() {
            log('state', 'üîó Hooking into Nulla...');
            
            // Hook detectIntent
            const originalDetectIntent = Nulla.detectIntent.bind(Nulla);
            Nulla.detectIntent = function(text) {
                const intent = originalDetectIntent(text);
                log('intent', `"${text}" ‚Üí ${intent}`);
                return intent;
            };
            
            // Hook processIntent
            const originalProcessIntent = Nulla.processIntent.bind(Nulla);
            Nulla.processIntent = async function(text) {
                log('state', `Processing: "${text}"`);
                try {
                    const result = await originalProcessIntent(text);
                    log('response', `Response: "${result?.text?.slice(0, 100)}..."`, {
                        mood: result?.mood,
                        fullResponse: result?.text
                    });
                    updateStateDisplay();
                    return result;
                } catch (e) {
                    log('error', `Process error: ${e.message}`);
                    throw e;
                }
            };
            
            // Hook search functions
            if (Nulla.searchDuckDuckGo) {
                const originalDDG = Nulla.searchDuckDuckGo.bind(Nulla);
                Nulla.searchDuckDuckGo = async function(query) {
                    log('api', `ü¶Ü DuckDuckGo search: "${query}"`);
                    try {
                        const result = await originalDDG(query);
                        log('search', `DDG result: ${result ? 'FOUND' : 'null'}`, result);
                        return result;
                    } catch (e) {
                        log('error', `DDG error: ${e.message}`);
                        throw e;
                    }
                };
            }
            
            if (Nulla.searchWikipedia) {
                const originalWiki = Nulla.searchWikipedia.bind(Nulla);
                Nulla.searchWikipedia = async function(query) {
                    log('api', `üìö Wikipedia search: "${query}"`);
                    try {
                        const result = await originalWiki(query);
                        log('search', `Wiki result: ${result ? 'FOUND' : 'null'}`, result);
                        return result;
                    } catch (e) {
                        log('error', `Wiki error: ${e.message}`);
                        throw e;
                    }
                };
            }
            
            // Hook saveState
            const originalSave = Nulla.saveState?.bind(Nulla);
            if (originalSave) {
                Nulla.saveState = async function() {
                    await originalSave();
                    log('state', 'üíæ State saved');
                    updateStateDisplay();
                };
            }
            
            // Hook addMessage
            const originalAddMessage = Nulla.addMessage?.bind(Nulla);
            if (originalAddMessage) {
                Nulla.addMessage = function(sender, text, mood) {
                    log('response', `[${sender}] ${text?.slice(0, 80)}...`);
                    return originalAddMessage(sender, text, mood);
                };
            }
            
            log('state', '‚úÖ All hooks installed');
            log('state', `Nulla version: ${Nulla.state?.version || 'unknown'}`);
            updateStateDisplay();
            
            // Periodic state updates
            setInterval(updateStateDisplay, 5000);
        }
        
        // ===== INTERCEPT CONSOLE =====
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        console.log = function(...args) {
            if (args[0]?.includes?.('Nulla') || args[0]?.includes?.('nulla')) {
                log('state', args.join(' '));
            }
            originalConsoleLog.apply(console, args);
        };
        
        console.warn = function(...args) {
            if (args[0]?.includes?.('Nulla') || args[0]?.includes?.('nulla')) {
                log('error', `‚ö†Ô∏è ${args.join(' ')}`);
            }
            originalConsoleWarn.apply(console, args);
        };
        
        console.error = function(...args) {
            log('error', `‚ùå ${args.join(' ')}`);
            originalConsoleError.apply(console, args);
        };
    </script>
</body>
</html>

